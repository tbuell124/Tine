# Mobile Deployment Guide

This guide walks through deploying the Tine mobile application to both iOS and Android using native builds created from the Expo-managed project. The steps are organized by platform and assume you are working from a macOS development machine that has access to an iOS device for testing. Each step is intentionally explicit so you can follow along without guessing about prerequisite tooling or command-line operations.

## 1. Prepare Your Development Machine

1. **Update macOS** so that you have the latest security patches and compatibility updates.
2. **Install Homebrew** (if not already installed) by running the script at <https://brew.sh/>. Homebrew simplifies managing the rest of the tooling.
3. **Install Node.js LTS and Watchman**:
   ```bash
   brew install node@20 watchman
   ```
   *Add Node.js 20 to your shell profile (e.g., `~/.zshrc`) if Homebrew does not link it automatically:*
   ```bash
   echo 'export PATH="/opt/homebrew/opt/node@20/bin:$PATH"' >> ~/.zshrc
   ```
4. **Install Yarn (optional but recommended)** for faster dependency installs:
   ```bash
   npm install --global yarn
   ```
5. **Install Expo CLI** to ensure you have project tooling available globally:
   ```bash
   npm install --global expo-cli
   ```
6. **Install Xcode** from the Mac App Store. After installation, launch Xcode once to accept the license agreements and install additional components.
7. **Install Xcode command line tools** (often prompted on first Xcode launch). If needed, trigger installation manually:
   ```bash
   xcode-select --install
   ```
8. **Install CocoaPods** (required for iOS native dependencies):
   ```bash
   sudo gem install cocoapods
   ```
9. **Install Android Studio** from <https://developer.android.com/studio>. During setup, ensure the following components are installed via the SDK Manager:
   - Android SDK Platform 34 (or the target SDK specified in `android/build.gradle`).
   - Android SDK Build-Tools 34.x.
   - Android Emulator (if you plan to run virtual devices).
   - Android SDK Command-line Tools (latest).
10. **Configure Android environment variables** in your shell profile (`~/.zshrc` or `~/.bash_profile`):
    ```bash
    export ANDROID_SDK_ROOT="$HOME/Library/Android/sdk"
    export ANDROID_HOME="$ANDROID_SDK_ROOT"
    export PATH="$ANDROID_SDK_ROOT/emulator:$ANDROID_SDK_ROOT/platform-tools:$PATH"
    ```
    *Reload your shell after editing the profile:*
    ```bash
    source ~/.zshrc
    ```
11. **Accept Android SDK licenses** so Gradle builds can run non-interactively:
    ```bash
    yes | sdkmanager --licenses
    ```

## 2. Clone the Repository

1. Choose a workspace directory (e.g., `~/Projects`).
2. Clone the repository from your source control host:
   ```bash
   git clone <REPOSITORY_URL>
   cd Tine
   ```
3. Confirm Node.js and npm versions:
   ```bash
   node --version
   npm --version
   ```
   *Make sure the Node.js version matches the LTS release used during installation.*

## 3. Prepare the Project from the Command Line

1. **Install JavaScript dependencies** using npm or Yarn:
   ```bash
   npm install
   # or
   yarn install
   ```
2. **Verify Expo configuration** to catch common issues early:
   ```bash
   npx expo-doctor
   ```
3. **Synchronize native projects with the Expo configuration** (only required if configuration has changed since the last native build):
   ```bash
   npx expo prebuild
   ```
   *If the `ios/` and `android/` directories already exist and are up to date, the command will finish quickly.*
4. **Install iOS CocoaPods dependencies**:
   ```bash
   npx pod-install ios
   ```
5. **Clean previous build artifacts** (recommended when switching branches or updating native dependencies):
   ```bash
   # iOS
   cd ios
   xcodebuild -workspace Tine.xcworkspace -scheme Tine clean
   cd ..

   # Android
   cd android
   ./gradlew clean
   cd ..
   ```
6. **Create a `.env` file** (if required by your project for environment-specific settings) by copying any provided example:
   ```bash
   cp .env.example .env
   ```
   *Update the values inside `.env` to match your local environment.*
7. **Run tests and lint checks** to ensure the project is healthy before opening the native IDEs:
   ```bash
   npm run lint
   npm test
   ```

## 4. Build and Test on iOS

1. **Open the Xcode workspace** generated by Expo:
   ```bash
   open ios/Tine.xcworkspace
   ```
2. In Xcode, select your development team for the `Tine` target under **Signing & Capabilities** to satisfy code signing requirements.
3. Plug in a physical iOS device and select it from the device selector in the Xcode toolbar (physical devices are required for many Expo modules).
4. From the menu bar, choose **Product ▸ Clean Build Folder** to ensure no stale artifacts remain.
5. Press **⌘B** (Product ▸ Build) to compile the project.
6. Press **⌘R** (Product ▸ Run) to install the app on the connected device. Monitor the Xcode console for runtime logs.
7. Verify that the app launches successfully and performs as expected on device. If runtime configuration is needed, update your `.env` or any native config files, rebuild, and retest.
8. When ready for distribution, use **Product ▸ Archive** to create an App Store build, then follow the Organizer workflow to upload the archive to App Store Connect.

## 5. Build and Test on Android

1. **Open Android Studio** and choose *Open an Existing Project*, then select the `android/` directory inside the repository.
2. Allow Android Studio to sync Gradle dependencies. Accept any prompts to install missing SDK packages or Android Gradle Plugin updates.
3. Connect an Android device with USB debugging enabled or start an Android Virtual Device from the Device Manager.
4. From the *Build* menu, choose **Clean Project** followed by **Rebuild Project** to ensure a fresh build state.
5. Press **Run ▸ Run 'app'** (or click the green Run arrow) to install and launch the app on the selected device or emulator.
6. Monitor *Logcat* for runtime logs and address any issues that surface.
7. For release builds, run the Gradle task from the terminal:
   ```bash
   cd android
   ./gradlew bundleRelease
   ```
   *The generated Android App Bundle (`.aab`) will be located under `android/app/build/outputs/bundle/release/` for upload to the Google Play Console.*

## 6. Post-Build Verification and Deployment

1. **Smoke test critical flows** on both platforms to confirm feature parity.
2. **Capture screenshots** and gather metadata required for App Store Connect and Google Play Console submissions.
3. **Document the build numbers and Git commit hash** associated with each release for traceability.
4. **Tag the release in Git** after the binaries are uploaded:
   ```bash
   git tag -a v<version> -m "Tine <version> release"
   git push origin v<version>
   ```
5. **Monitor crash and analytics dashboards** (e.g., Sentry, Firebase) after release to catch regressions quickly.

By following these steps sequentially you ensure both native projects stay in sync with the Expo-managed source, eliminating common deployment pitfalls while delivering consistent builds to iOS and Android users.
